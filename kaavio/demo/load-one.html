<!DOCTYPE html>
<html style="margin: 0; width: 100%; height: 100%; ">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <title>Pvjs Template</title>

    <style type="text/css">
      html, body, x-layout{width: 100%;height: 100%;margin: 0;}
      #pvjs-header{background-color: gray;}
      #pvjs-inner-modal{width: 100%;height: 100%;margin: 10;border: 10;background-color: white;}
      #pvjs-section{width: 100%;height: 80%;margin: 0;}
      #pvjs-footer{background-color: gray;}
    </style>

    <!-- Required by Highlight Plugin -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.2/typeahead.bundle.min.js"></script>

    <script src="http://www.x-tags.org/js/x-tag-components.js"></script>
    <link rel="stylesheet" type="text/css" href="http://www.x-tags.org/css/x-tag-components.css"/>

    <script src="https://rawgit.com/caolan/highland/master/dist/highland.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.6/d3.min.js"></script>

    <script src="https://rawgit.com/davidjbradshaw/iframe-resizer/master/js/iframeResizer.min.js"></script>
    <script src="https://rawgit.com/davidjbradshaw/iframe-resizer/master/js/iframeResizer.contentWindow.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <script src="./lib/pvjs/pvjs-2.1.3.bundle.min.js"></script>

  </head>
  <body>

  <x-layout id="pvjs-container" class="pvjs-container">
    <header id="pvjs-header">
      I'm the header!<br>
      I'm the header!<br>
      I'm the header!<br>
    </header>
    <section id="pvjs-section">
      <div id="pvjs-viewer">
    </section>
    <footer id="pvjs-footer">

      <style type="text/css">
        html, body, x-layout{width: 100%;height: 100%;margin: 0;}
      </style>

      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

      <script src="https://rawgit.com/caolan/highland/master/dist/highland.js"></script>
      <script src="https://rawgit.com/davidjbradshaw/iframe-resizer/master/js/iframeResizer.contentWindow.min.js"></script>
      <script src="https://bridgedb.github.io/bridgedbjs/dist/bridgedb-4.0.0.min.js"></script>
      <bridgedb-xref-search></bridgedb-xref-search>
    </footer>
    <!-- We can put the x-modal just before the closing x-layout tag to cover up
          the entire x-layout-->
    <!--
    <x-modal id="pvjs-inner-modal" escape-hide>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
      Place content markup here<br>
    </x-modal>
  </x-layout>
  -->

  <!-- include riot.js -->
  <script src="https://muut.com/riotjs/dist/demo/js/riot.js"></script>

  <!-- include the tag -->
  <script src="./bridgedb-xref-search.js"></script>

  <!-- mount the tag -->
  <script>riot.mount('bridgedb-xref-search')</script>

  <script>

  /*
  xtag.register('bridgedb-xref-search', {
    // TODO extends isn't working
    //extends: 'div',
    lifecycle: {
      created: function() {
        // TODO compile the template and insert it as a string, using the script tag method of including another page in this one
        xtag.innerHTML(this, '<iframe id="bridgedb-xref-search-frame" src="./bridgedb-xref-search-template.html" style="width:inherit; height:inherit; margin:0px; border: 0px; " />');

        iFrameResize({
          enablePublicMethods: true,
          messageCallback: function(response) {
            console.log('bridgedb-xref-search sends message');
            console.log(response.message);
            //document.querySelector('#pvjs-inner-modal').innerHTML = response.message;
          },
          resizedCallback: function() {
            console.log('bridgedb-xref-search parent says resized');
          }
        },'#bridgedb-xref-search-frame');

      }
    }
  });
  //*/

  /* *******************
  /* Load pvjs
  /* *******************/
  $(function() {
    $('#pvjs-viewer').pvjs({
      fitToContainer: true
    , manualRender: true
    , sourceData: [
        // at least one item required
        {
          // uri:'data/wp1.xml',
          // uri:'data/WP525_74871.gpml',
          uri:'data/WP525_73040.gpml',
          // uri:'http://pointer.ucsf.edu/d3/r/data-sources/gpml.php?id=WP1',
          fileType:'gpml' // generally will correspond to filename extension
        }
      , {
          uri:'http://www.wikipathways.org//wpi/wpi.php?action=downloadFile&type=png&pwTitle=Pathway:WP1',
          fileType:'biopax'
        }
      , {
          uri:'http://www.wikipathways.org//wpi/wpi.php?action=downloadFile&type=png&pwTitle=Pathway:WP1',
          fileType:'png'
        }
      ]
    });

    /*
    if ('parentIFrame' in window) {
      parentIFrame.close();
    }
    //*/

    // Get first element from array of instances
    var pathInstance = $('#pvjs-viewer').pvjs('get').pop();
    window.pathInstance = pathInstance;

    highland('click', $('#pvjs-viewer')).each(function() {
      console.log('click');
    });

    // Load notification plugin
    pvjsNotifications(pathInstance, {displayErrors: true, displayWarnings: true});

    // Call after render
    pathInstance.on('rendered', function() {
      // Initialize Highlighter plugin
      var hi = pvjsHighlighter(pathInstance);
      window.hi = hi;

      // Highlight by ID
      hi.highlight('#eb5');
      hi.highlight('id:d25e1');

      // Highlight by Text
      hi.highlight('Mitochondrion', null, {backgroundColor: 'gray'});

      // Highlight by xref
      hi.highlight('xref:id:http://identifiers.org/wormbase/ZK1193.5', null, {backgroundColor: 'magenta', borderColor: 'black'});
      hi.highlight('xref:GCN-2', null, {
        backgroundColor: 'blue'
      , backgroundOpacity: 0.5
      , borderColor: 'red'
      , borderWidth: 1
      , borderOpacity: 0.7
      });

      /*
      window.addEventListener('resize', function(event) {
        console.log('event in load-one');
        console.log(event);
      }, false);
      //*/
    });

    // Call renderer
    pathInstance.render();

  });
  </script>

</body>
</html>
